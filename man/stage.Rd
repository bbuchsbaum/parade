% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/flow.R
\name{stage}
\alias{stage}
\title{Add a processing stage to a parade flow}
\usage{
stage(
  fl,
  id,
  f,
  needs = character(),
  schema,
  prefix = TRUE,
  sink = NULL,
  skip_when = NULL,
  hoist_struct = FALSE,
  inputs = NULL,
  input_artifacts = NULL,
  outputs = NULL,
  io_mode = c("off", "warn", "error"),
  retries = NULL,
  retry_backoff = NULL,
  retry_base = NULL,
  retry_on = NULL,
  resources = NULL,
  cpus = NULL,
  memory = NULL,
  time = NULL,
  ...
)
}
\arguments{
\item{fl}{A \code{parade_flow} object}

\item{id}{Unique stage identifier (character)}

\item{f}{Function to execute for this stage}

\item{needs}{Character vector of stage IDs this stage depends on}

\item{schema}{Schema defining expected output structure (from \code{returns()})}

\item{prefix}{Whether to prefix output columns with stage ID (logical)}

\item{sink}{Optional sink specification for artifact persistence}

\item{skip_when}{Optional function to determine when to skip this stage}

\item{hoist_struct}{Whether to hoist nested data structures (logical)}

\item{inputs}{Optional character vector of required input names for this stage.}

\item{input_artifacts}{Optional character vector of \code{inputs} that must be
artifact/file-reference values.}

\item{outputs}{Optional character vector of declared output names.
Defaults to schema column names.}

\item{io_mode}{I/O contract behavior: \code{"off"} (default), \code{"warn"}, or \code{"error"}.}

\item{retries}{Optional stage-level retry override (non-negative integer).}

\item{retry_backoff}{Optional stage-level retry backoff override:
\code{"none"}, \code{"fixed"}, \code{"linear"}, \code{"exponential"}.}

\item{retry_base}{Optional stage-level retry base delay (seconds).}

\item{retry_on}{Optional stage-level retry classifier override.}

\item{resources}{Optional stage-level resource hints as a named list with
keys \code{cpus}, \code{memory}, \code{time} (aliases: \code{cpus_per_task}, \code{ncpus}, \code{mem}).}

\item{cpus}{Optional stage-level CPUs per task hint.}

\item{memory}{Optional stage-level memory hint.}

\item{time}{Optional stage-level walltime hint.}

\item{...}{Additional constant arguments passed to the stage function}
}
\value{
The input flow with the new stage added
}
\description{
A stage defines a computational step in the flow with typed inputs and
outputs, optional dependencies, and configurable data handling options.
}
\examples{
grid <- data.frame(x = 1:3)
fl <- flow(grid) |>
  stage("double", function(x) x * 2, schema = returns(result = dbl()))
}
