<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mirai backend: fast, scalable parallel execution • parade</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mirai backend: fast, scalable parallel execution">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">parade</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Mirai backend: fast, scalable parallel execution</h1>
            
      

      <div class="d-none name"><code>parade-mirai.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="why-mirai">Why mirai?<a class="anchor" aria-label="anchor" href="#why-mirai"></a>
</h2>
<p>The mirai backend brings several powerful advantages to parade
workflows:</p>
<ul>
<li>
<strong>No connection limits</strong>: Scale beyond R’s 125
connection limit</li>
<li>
<strong>Low-latency execution</strong>: Persistent daemons with
dispatcher for minimal overhead</li>
<li>
<strong>Secure remote execution</strong>: Built-in TLS and SSH
tunneling support</li>
<li>
<strong>HPC compliance</strong>: Launch daemons through SLURM while
maintaining scheduler policies</li>
<li>
<strong>Simple local development</strong>: Drop-in replacement for
multisession with better performance</li>
</ul>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="section level3">
<h3 id="local-development">Local development<a class="anchor" aria-label="anchor" href="#local-development"></a>
</h3>
<p>The simplest way to use mirai is as a replacement for the standard
multisession backend:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bbuchsbaum.github.io/parade/">parade</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize mirai with auto-detected cores</span></span>
<span><span class="fu"><a href="../reference/mirai_init.html">mirai_init</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or use the distribution interface</span></span>
<span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flow.html">flow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stage.html">stage</a></span><span class="op">(</span><span class="st">"process"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span>, schema <span class="op">=</span> <span class="fu"><a href="../reference/returns.html">returns</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="../reference/dbl.html">dbl</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/distribute.html">distribute</a></span><span class="op">(</span><span class="fu"><a href="../reference/use_mirai_local.html">use_mirai_local</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/collect.html">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This provides instant parallelism without any configuration, and
often with better performance than traditional backends for many small
tasks.</p>
</div>
<div class="section level3">
<h3 id="comparison-with-other-backends">Comparison with other backends<a class="anchor" aria-label="anchor" href="#comparison-with-other-backends"></a>
</h3>
<table class="table">
<colgroup>
<col width="24%">
<col width="31%">
<col width="19%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th>Scenario</th>
<th>Traditional</th>
<th>Mirai</th>
<th>Benefits</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Many small tasks</td>
<td><code><a href="../reference/dist_local.html">dist_local()</a></code></td>
<td><code><a href="../reference/use_mirai_local.html">use_mirai_local()</a></code></td>
<td>Lower overhead, faster</td>
</tr>
<tr class="even">
<td>&gt;125 workers</td>
<td>Not possible</td>
<td><code>dist_mirai(n = 200)</code></td>
<td>No connection limits</td>
</tr>
<tr class="odd">
<td>Remote execution</td>
<td>Complex setup</td>
<td><code><a href="../reference/use_mirai_ssh.html">use_mirai_ssh()</a></code></td>
<td>Built-in SSH tunneling</td>
</tr>
<tr class="even">
<td>HPC clusters</td>
<td><code><a href="../reference/dist_slurm.html">dist_slurm()</a></code></td>
<td><code><a href="../reference/use_mirai_slurm.html">use_mirai_slurm()</a></code></td>
<td>Lower latency, persistent workers</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="distribution-patterns">Distribution Patterns<a class="anchor" aria-label="anchor" href="#distribution-patterns"></a>
</h2>
<div class="section level3">
<h3 id="local-daemons">1. Local Daemons<a class="anchor" aria-label="anchor" href="#local-daemons"></a>
</h3>
<p>For development and single-machine workflows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Basic local setup</span></span>
<span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dist_mirai.html">dist_mirai</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With explicit configuration</span></span>
<span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dist_mirai.html">dist_mirai</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dispatcher <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># Enable load balancing</span></span>
<span>  within <span class="op">=</span> <span class="st">"mirai"</span>,   <span class="co"># Use mirai for nested parallelization</span></span>
<span>  workers_within <span class="op">=</span> <span class="fl">4</span>  <span class="co"># Nested workers per daemon</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply to flow</span></span>
<span><span class="va">fl</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/distribute.html">distribute</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/collect.html">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="slurm-managed-daemon-pools">2. SLURM-Managed Daemon Pools<a class="anchor" aria-label="anchor" href="#slurm-managed-daemon-pools"></a>
</h3>
<p>Launch mirai daemons through SLURM for HPC-compliant distributed
execution:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Configure SLURM-launched daemons</span></span>
<span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/use_mirai_slurm.html">use_mirai_slurm</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">16</span>,                    <span class="co"># Number of daemon jobs</span></span>
<span>  partition <span class="op">=</span> <span class="st">"compute"</span>,     <span class="co"># SLURM partition</span></span>
<span>  time <span class="op">=</span> <span class="st">"2:00:00"</span>,         <span class="co"># Wall time</span></span>
<span>  mem <span class="op">=</span> <span class="st">"32G"</span>,              <span class="co"># Memory per daemon</span></span>
<span>  cpus <span class="op">=</span> <span class="fl">8</span>,                 <span class="co"># CPUs per daemon</span></span>
<span>  tls <span class="op">=</span> <span class="cn">TRUE</span>,               <span class="co"># Use TLS encryption</span></span>
<span>  port <span class="op">=</span> <span class="fl">5555</span>               <span class="co"># TLS port</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Submit flow with SLURM daemons</span></span>
<span><span class="va">fl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/distribute.html">distribute</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/submit.html">submit</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Returns immediately</span></span>
<span></span>
<span><span class="co"># Monitor status</span></span>
<span><span class="fu"><a href="../reference/deferred_status.html">deferred_status</a></span><span class="op">(</span><span class="va">handle</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/deferred_collect.html">deferred_collect</a></span><span class="op">(</span><span class="va">handle</span><span class="op">)</span></span></code></pre></div>
<p>The daemons run as SLURM jobs, ensuring compliance with cluster
policies while providing low-latency task execution.</p>
</div>
<div class="section level3">
<h3 id="ssh-tunneling-for-firewalled-clusters">3. SSH Tunneling for Firewalled Clusters<a class="anchor" aria-label="anchor" href="#ssh-tunneling-for-firewalled-clusters"></a>
</h3>
<p>Connect to remote nodes through SSH, even when direct connections are
blocked:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SSH with tunneling (for firewalled nodes)</span></span>
<span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/use_mirai_ssh.html">use_mirai_ssh</a></span><span class="op">(</span></span>
<span>  remotes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ssh://node1"</span>, <span class="st">"ssh://node2"</span>, <span class="st">"ssh://node3"</span><span class="op">)</span>,</span>
<span>  tunnel <span class="op">=</span> <span class="cn">TRUE</span>,      <span class="co"># Use SSH tunneling</span></span>
<span>  port <span class="op">=</span> <span class="fl">40491</span>       <span class="co"># Local port for tunnel</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Direct SSH (when ports are open)</span></span>
<span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/use_mirai_ssh.html">use_mirai_ssh</a></span><span class="op">(</span></span>
<span>  remotes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ssh://compute1"</span>, <span class="st">"ssh://compute2"</span><span class="op">)</span>,</span>
<span>  tunnel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fl</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/distribute.html">distribute</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/collect.html">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>SSH tunneling allows secure connections even in restricted network
environments.</p>
</div>
</div>
<div class="section level2">
<h2 id="advanced-configuration">Advanced Configuration<a class="anchor" aria-label="anchor" href="#advanced-configuration"></a>
</h2>
<div class="section level3">
<h3 id="manual-daemon-setup">Manual Daemon Setup<a class="anchor" aria-label="anchor" href="#manual-daemon-setup"></a>
</h3>
<p>For full control over the mirai configuration:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mirai.r-lib.org" class="external-link">mirai</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up custom TLS-secured daemons</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mirai.r-lib.org/reference/host_url.html" class="external-link">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span>, port <span class="op">=</span> <span class="fl">5555</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Configure SLURM submission</span></span>
<span><span class="va">opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"#SBATCH --partition=highmem"</span>,</span>
<span>  <span class="st">"#SBATCH --time=04:00:00"</span>,</span>
<span>  <span class="st">"#SBATCH --mem=64G"</span>,</span>
<span>  <span class="st">"#SBATCH --job-name=my-analysis"</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"\n"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mirai.r-lib.org/reference/cluster_config.html" class="external-link">cluster_config</a></span><span class="op">(</span>command <span class="op">=</span> <span class="st">"sbatch"</span>, options <span class="op">=</span> <span class="va">opts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Launch daemons</span></span>
<span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">32</span>, url <span class="op">=</span> <span class="va">url</span>, remote <span class="op">=</span> <span class="va">cfg</span>, dispatcher <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use with parade via future</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.mirai</span><span class="fu">::</span><span class="va"><a href="https://future.mirai.futureverse.org/reference/mirai_cluster.html" class="external-link">mirai_cluster</a></span><span class="op">)</span></span>
<span><span class="va">fl</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/collect.html">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dynamic-scaling">Dynamic Scaling<a class="anchor" aria-label="anchor" href="#dynamic-scaling"></a>
</h3>
<p>Adjust daemon count based on workload:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start with a few daemons</span></span>
<span><span class="fu"><a href="../reference/mirai_init.html">mirai_init</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scale up for intensive processing</span></span>
<span><span class="fu"><a href="../reference/mirai_scale.html">mirai_scale</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collect.html">collect</a></span><span class="op">(</span><span class="va">heavy_flow</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scale down when done</span></span>
<span><span class="fu"><a href="../reference/mirai_scale.html">mirai_scale</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check status</span></span>
<span><span class="fu"><a href="../reference/mirai_status.html">mirai_status</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/mirai_dispatcher_status.html">mirai_dispatcher_status</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="chunking-strategies">Chunking Strategies<a class="anchor" aria-label="anchor" href="#chunking-strategies"></a>
</h3>
<p>Optimize task distribution with mirai’s dispatcher:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fine-grained parallelism (many small tasks)</span></span>
<span><span class="fu"><a href="../reference/dist_mirai.html">dist_mirai</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  dispatcher <span class="op">=</span> <span class="cn">TRUE</span>,     <span class="co"># Essential for load balancing</span></span>
<span>  chunks_per_job <span class="op">=</span> <span class="fl">1</span>     <span class="co"># One group per task</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Coarse-grained parallelism (fewer large tasks)</span></span>
<span><span class="fu"><a href="../reference/dist_mirai.html">dist_mirai</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  dispatcher <span class="op">=</span> <span class="cn">FALSE</span>,    <span class="co"># Direct task assignment</span></span>
<span>  chunks_per_job <span class="op">=</span> <span class="fl">10</span>    <span class="co"># Bundle groups together</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="practical-examples">Practical Examples<a class="anchor" aria-label="anchor" href="#practical-examples"></a>
</h2>
<div class="section level3">
<h3 id="example-1-large-scale-simulation-on-local-machine">Example 1: Large-scale simulation on local machine<a class="anchor" aria-label="anchor" href="#example-1-large-scale-simulation-on-local-machine"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bbuchsbaum.github.io/parade/">parade</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parameter grid with 10,000 combinations</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use mirai to bypass connection limits</span></span>
<span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flow.html">flow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stage.html">stage</a></span><span class="op">(</span><span class="st">"simulate"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">alpha</span>, <span class="va">beta</span>, <span class="va">n_sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">n_sim</span><span class="op">)</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1000</span>, shape <span class="op">=</span> <span class="va">alpha</span>, rate <span class="op">=</span> <span class="va">beta</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,</span>
<span>      var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,</span>
<span>      ks_p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ks.test.html" class="external-link">ks.test</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"pgamma"</span>, <span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span>, schema <span class="op">=</span> <span class="fu"><a href="../reference/returns.html">returns</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="../reference/dbl.html">dbl</a></span><span class="op">(</span><span class="op">)</span>, var <span class="op">=</span> <span class="fu"><a href="../reference/dbl.html">dbl</a></span><span class="op">(</span><span class="op">)</span>, ks_p <span class="op">=</span> <span class="fu"><a href="../reference/dbl.html">dbl</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/distribute.html">distribute</a></span><span class="op">(</span><span class="fu"><a href="../reference/dist_mirai.html">dist_mirai</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span>  <span class="co"># 200 workers!</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collect.html">collect</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-2-remote-execution-on-hpc-cluster">Example 2: Remote execution on HPC cluster<a class="anchor" aria-label="anchor" href="#example-2-remote-execution-on-hpc-cluster"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Development: test locally</span></span>
<span><span class="va">fl_dev</span> <span class="op">&lt;-</span> <span class="va">fl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/distribute.html">distribute</a></span><span class="op">(</span><span class="fu"><a href="../reference/use_mirai_local.html">use_mirai_local</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_results</span> <span class="op">&lt;-</span> <span class="va">fl_dev</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/collect.html">collect</a></span><span class="op">(</span>limit <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Production: scale to cluster</span></span>
<span><span class="va">fl_prod</span> <span class="op">&lt;-</span> <span class="va">fl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/distribute.html">distribute</a></span><span class="op">(</span><span class="fu"><a href="../reference/use_mirai_slurm.html">use_mirai_slurm</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fl">64</span>,</span>
<span>    partition <span class="op">=</span> <span class="st">"compute"</span>,</span>
<span>    time <span class="op">=</span> <span class="st">"12:00:00"</span>,</span>
<span>    mem <span class="op">=</span> <span class="st">"256G"</span>,</span>
<span>    account <span class="op">=</span> <span class="st">"project-123"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">handle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit.html">submit</a></span><span class="op">(</span><span class="va">fl_prod</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Monitor progress</span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="../reference/deferred_status.html">deferred_status</a></span><span class="op">(</span><span class="va">handle</span><span class="op">)</span><span class="op">$</span><span class="va">done</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/deferred_status.html">deferred_status</a></span><span class="op">(</span><span class="va">handle</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">status</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">final_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/deferred_collect.html">deferred_collect</a></span><span class="op">(</span><span class="va">handle</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-3-cross-platform-workflow">Example 3: Cross-platform workflow<a class="anchor" aria-label="anchor" href="#example-3-cross-platform-workflow"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Detect environment and choose appropriate backend</span></span>
<span><span class="va">get_distribution</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"SLURM_JOB_ID"</span><span class="op">)</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Running on SLURM</span></span>
<span>    <span class="fu"><a href="../reference/use_mirai_slurm.html">use_mirai_slurm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">32</span>, partition <span class="op">=</span> <span class="st">"compute"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"~/.ssh/compute_nodes"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Has SSH access to compute nodes</span></span>
<span>    <span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">"~/.ssh/compute_nodes"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/use_mirai_ssh.html">use_mirai_ssh</a></span><span class="op">(</span>remotes <span class="op">=</span> <span class="va">nodes</span>, tunnel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># Local development</span></span>
<span>    <span class="fu"><a href="../reference/use_mirai_local.html">use_mirai_local</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Portable workflow</span></span>
<span><span class="va">fl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/distribute.html">distribute</a></span><span class="op">(</span><span class="fu">get_distribution</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/collect.html">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="performance-considerations">Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a>
</h2>
<div class="section level3">
<h3 id="when-to-use-mirai-vs-traditional-backends">When to use mirai vs traditional backends<a class="anchor" aria-label="anchor" href="#when-to-use-mirai-vs-traditional-backends"></a>
</h3>
<table class="table">
<colgroup>
<col width="30%">
<col width="36%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Use Case</th>
<th>Best Choice</th>
<th>Reasoning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Few large tasks</td>
<td>
<code><a href="../reference/dist_local.html">dist_local()</a></code> or <code><a href="../reference/dist_slurm.html">dist_slurm()</a></code>
</td>
<td>Traditional backends work well</td>
</tr>
<tr class="even">
<td>Many small tasks</td>
<td><code><a href="../reference/dist_mirai.html">dist_mirai()</a></code></td>
<td>Lower per-task overhead</td>
</tr>
<tr class="odd">
<td>&gt;125 parallel tasks</td>
<td><code><a href="../reference/dist_mirai.html">dist_mirai()</a></code></td>
<td>Only option beyond connection limit</td>
</tr>
<tr class="even">
<td>Need load balancing</td>
<td><code>dist_mirai(dispatcher = TRUE)</code></td>
<td>Automatic work distribution</td>
</tr>
<tr class="odd">
<td>Firewalled cluster</td>
<td><code>use_mirai_ssh(tunnel = TRUE)</code></td>
<td>SSH tunneling support</td>
</tr>
<tr class="even">
<td>Require TLS security</td>
<td><code>dist_mirai(tls = TRUE)</code></td>
<td>Built-in encryption</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="optimizing-dispatcher-performance">Optimizing dispatcher performance<a class="anchor" aria-label="anchor" href="#optimizing-dispatcher-performance"></a>
</h3>
<p>The dispatcher provides automatic load balancing but adds slight
overhead:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For homogeneous tasks (similar runtime)</span></span>
<span><span class="fu"><a href="../reference/dist_mirai.html">dist_mirai</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">16</span>, dispatcher <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For heterogeneous tasks (varying runtime)</span></span>
<span><span class="fu"><a href="../reference/dist_mirai.html">dist_mirai</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">16</span>, dispatcher <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For embarrassingly parallel workflows</span></span>
<span><span class="fu"><a href="../reference/dist_mirai.html">dist_mirai</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">32</span>,</span>
<span>  dispatcher <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  chunks_per_job <span class="op">=</span> <span class="fl">1</span>  <span class="co"># Maximum parallelism</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<div class="section level3">
<h3 id="common-issues-and-solutions">Common issues and solutions<a class="anchor" aria-label="anchor" href="#common-issues-and-solutions"></a>
</h3>
<p><strong>Issue</strong>: “Cannot connect to daemons”</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check daemon status</span></span>
<span><span class="fu"><a href="../reference/mirai_status.html">mirai_status</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Restart daemons</span></span>
<span><span class="fu"><a href="../reference/mirai_stop.html">mirai_stop</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/mirai_init.html">mirai_init</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><strong>Issue</strong>: “Tasks not distributing evenly”</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ensure dispatcher is enabled</span></span>
<span><span class="fu"><a href="../reference/dist_mirai.html">dist_mirai</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">16</span>, dispatcher <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check dispatcher status</span></span>
<span><span class="fu"><a href="../reference/mirai_dispatcher_status.html">mirai_dispatcher_status</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><strong>Issue</strong>: “SSH connection fails”</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test SSH manually first</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"ssh node1 echo 'connected'"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use verbose mode for debugging</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>MIRAI_DEBUG <span class="op">=</span> <span class="st">"TRUE"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Issue</strong>: “SLURM daemons not starting”</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check SLURM submission manually</span></span>
<span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  url <span class="op">=</span> <span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/host_url.html" class="external-link">host_url</a></span><span class="op">(</span>tls <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  remote <span class="op">=</span> <span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/cluster_config.html" class="external-link">cluster_config</a></span><span class="op">(</span></span>
<span>    command <span class="op">=</span> <span class="st">"sbatch"</span>,</span>
<span>    options <span class="op">=</span> <span class="st">"#SBATCH --partition=debug\n#SBATCH --time=00:05:00"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check SLURM queue</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"squeue -u $USER"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p><strong>Always cleanup daemons</strong>: Use
<code>stop_on_exit = TRUE</code> (default) or explicitly call
<code><a href="../reference/mirai_stop.html">mirai_stop()</a></code></p></li>
<li>
<p><strong>Choose appropriate daemon count</strong>:</p>
<ul>
<li>Local: number of cores</li>
<li>Remote: 2-4x number of physical machines</li>
<li>SLURM: Based on partition limits</li>
</ul>
</li>
<li>
<p><strong>Use TLS for production</strong>: Enable encryption for
sensitive data</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dist_mirai.html">dist_mirai</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">16</span>, tls <span class="op">=</span> <span class="cn">TRUE</span>, port <span class="op">=</span> <span class="fl">5555</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Monitor resource usage</strong>: Track daemon
performance</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># During execution</span></span>
<span><span class="fu"><a href="../reference/mirai_dispatcher_status.html">mirai_dispatcher_status</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># After completion</span></span>
<span><span class="fu"><a href="../reference/mirai_status.html">mirai_status</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Test locally before scaling</strong>: Verify workflow
correctness</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Development</span></span>
<span><span class="va">fl</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/distribute.html">distribute</a></span><span class="op">(</span><span class="fu"><a href="../reference/use_mirai_local.html">use_mirai_local</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/collect.html">collect</a></span><span class="op">(</span>limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Production</span></span>
<span><span class="va">fl</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/distribute.html">distribute</a></span><span class="op">(</span><span class="fu"><a href="../reference/use_mirai_slurm.html">use_mirai_slurm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">64</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/submit.html">submit</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The mirai backend extends parade’s capabilities with:</p>
<ul>
<li>
<strong>Unlimited parallelism</strong>: No connection limits</li>
<li>
<strong>Flexible deployment</strong>: Local, SSH, or SLURM</li>
<li>
<strong>Enhanced security</strong>: TLS and SSH tunneling</li>
<li>
<strong>Better performance</strong>: Low-latency task execution</li>
<li>
<strong>Simple interface</strong>: Drop-in replacement for existing
backends</li>
</ul>
<p>Whether you’re developing locally or scaling to hundreds of nodes,
mirai provides the performance and flexibility needed for modern
parallel computing workflows.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Parade Authors.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
