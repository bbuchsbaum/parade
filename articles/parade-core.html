<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Parade core: declarative flows, types, and execution • parade</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parade core: declarative flows, types, and execution">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">parade</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.11.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/parade-core.html">Parade core: declarative flows, types, and execution</a></li>
    <li><a class="dropdown-item" href="../articles/parade-defaults-profiles.html">SLURM Profiles: Environment-Specific Configurations</a></li>
    <li><a class="dropdown-item" href="../articles/parade-defaults.html">Using SLURM Defaults in parade</a></li>
    <li><a class="dropdown-item" href="../articles/parade-mirai.html">Mirai backend: fast, scalable parallel execution</a></li>
    <li><a class="dropdown-item" href="../articles/parade-paths.html">Scratch-first paths &amp; registries: project://, artifacts://, registry://</a></li>
    <li><a class="dropdown-item" href="../articles/parade-scripts-monitoring.html">SLURM script submission and monitoring from R</a></li>
    <li><a class="dropdown-item" href="../articles/parade-sinks.html">Artifacts: clean side-effects, atomic writes, and manifests</a></li>
    <li><a class="dropdown-item" href="../articles/parade-slurm-distribution.html">Distribution: local and SLURM (barriers, throttling, chunking)</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Parade core: declarative flows, types, and execution</h1>
            
      

      <div class="d-none name"><code>parade-core.Rmd</code></div>
    </div>

    
    
<blockquote>
<p>Requires <strong>parade ≥ 0.6.0</strong>
(flow/stage/distribute/collect).</p>
</blockquote>
<div class="section level2">
<h2 id="what-is-parade">What is parade?<a class="anchor" aria-label="anchor" href="#what-is-parade"></a>
</h2>
<p><strong>parade</strong> is a declarative parallel dataflow framework
for R that enables you to:</p>
<ul>
<li>Build <strong>typed computational pipelines</strong> with explicit
dependencies</li>
<li>Execute workflows <strong>locally or on HPC clusters</strong>
(including SLURM)</li>
<li>Manage <strong>parameter grids</strong> for batch processing</li>
<li>Track <strong>artifacts and diagnostics</strong> automatically</li>
<li>Handle <strong>errors gracefully</strong> with configurable
policies</li>
</ul>
<p>Think of parade as a way to turn complex, multi-step analyses into
reproducible, scalable workflows that can run anywhere from your laptop
to a supercomputer.</p>
</div>
<div class="section level2">
<h2 id="core-concepts">Core concepts<a class="anchor" aria-label="anchor" href="#core-concepts"></a>
</h2>
<pre><code>Parameter Grid → Flow Definition → Stage Execution → Results Collection
     ↓               ↓                    ↓              ↓
   subjects,    typed stages with    parallel or      tibble with
   sessions,    dependencies and     sequential       diagnostics
   conditions   error handling       execution        &amp; artifacts</code></pre>
<p>This vignette covers the <em>essentials</em>: parameter grids, typed
stage outputs, DAG wiring, and execution.</p>
</div>
<div class="section level2">
<h2 id="grid-flow-setting-up-your-parameter-space">1) Grid → Flow: Setting up your parameter space<a class="anchor" aria-label="anchor" href="#grid-flow-setting-up-your-parameter-space"></a>
</h2>
<p>The foundation of any parade workflow is a <strong>parameter
grid</strong> that defines all the combinations of parameters you want
to process:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bbuchsbaum.github.io/parade/">parade</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://progressr.futureverse.org" class="external-link">progressr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize path aliases for consistent artifact management</span></span>
<span><span class="fu"><a href="../reference/paths_init.html">paths_init</a></span><span class="op">(</span><span class="op">)</span>                               <span class="co"># stable aliases (project://, artifacts://, registry://)</span></span>
<span></span>
<span><span class="co"># Create a parameter grid - each row represents one "job"</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/param_grid.html">param_grid</a></span><span class="op">(</span>subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s01"</span>,<span class="st">"s02"</span><span class="op">)</span>,</span>
<span>                   session <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>                   seed <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This creates 2 × 2 × 4 = 16 parameter combinations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span></code></pre></div>
<p>Now we create a <strong>flow</strong> from this grid. A flow is a
computational pipeline that will be applied to each row of the parameter
grid:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flow.html">flow</a></span><span class="op">(</span><span class="va">grid</span>, seed_col <span class="op">=</span> <span class="st">"seed"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stage.html">stage</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"prep"</span>,</span>
<span>    f  <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">subject</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Each stage function receives parameters from the current grid row</span></span>
<span>      <span class="co"># This stage creates some mock data based on the session</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, y <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="va">session</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    <span class="co"># Define the expected output structure with types</span></span>
<span>    schema <span class="op">=</span> <span class="fu"><a href="../reference/schema.html">schema</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fu"><a href="../reference/lst.html">lst</a></span><span class="op">(</span>ptype <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="../reference/int.html">int</a></span><span class="op">(</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="../reference/int.html">int</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># Hoist the nested list structure to top-level columns</span></span>
<span>    hoist_struct <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stage.html">stage</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"fit"</span>,</span>
<span>    needs <span class="op">=</span> <span class="st">"prep"</span>,  <span class="co"># This stage depends on the "prep" stage</span></span>
<span>    f  <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">prep.df</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Stage functions can access outputs from previous stages</span></span>
<span>      <span class="co"># Notice the naming: prep.df refers to the 'df' output from 'prep' stage</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">prep.df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    schema <span class="op">=</span> <span class="fu"><a href="../reference/schema.html">schema</a></span><span class="op">(</span>mean_y <span class="op">=</span> <span class="fu"><a href="../reference/dbl.html">dbl</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># View the flow structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span></span></code></pre></div>
<p><strong>Key concepts:</strong></p>
<ul>
<li>
<strong><code>seed_col</code></strong>: Ensures reproducible random
number generation</li>
<li>
<strong><code>schema</code></strong>: Defines expected output types
for validation and optimization</li>
<li>
<strong><code>needs</code></strong>: Creates dependencies between
stages (forms a DAG)</li>
<li>
<strong><code>hoist_struct</code></strong>: Flattens nested lists
into separate columns</li>
</ul>
</div>
<div class="section level2">
<h2 id="deterministic-types-validation-contracts">2) Deterministic types + validation contracts<a class="anchor" aria-label="anchor" href="#deterministic-types-validation-contracts"></a>
</h2>
<p>Parade’s type system ensures your pipeline produces consistent,
validated outputs:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl2</span> <span class="op">&lt;-</span> <span class="va">fl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stage.html">stage</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"check"</span>,</span>
<span>    needs <span class="op">=</span> <span class="st">"fit"</span>,</span>
<span>    f  <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit.mean_y</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Validate that our computed mean is sensible</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ok <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">fit.mean_y</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    schema <span class="op">=</span> <span class="fu"><a href="../reference/schema.html">schema</a></span><span class="op">(</span>ok <span class="op">=</span> <span class="fu"><a href="../reference/lgl.html">lgl</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># Expect a logical output</span></span>
<span>    ... <span class="op">=</span> <span class="cn">NULL</span>  <span class="co"># No additional constant arguments</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the complete pipeline</span></span>
<span><span class="fu"><a href="../reference/explain.html">explain</a></span><span class="op">(</span><span class="va">fl2</span><span class="op">)</span>  <span class="co"># Shows stage dependencies and output schemas</span></span></code></pre></div>
<p><strong>Available types:</strong> - <code><a href="../reference/dbl.html">dbl()</a></code> -
double/numeric values - <code><a href="../reference/int.html">int()</a></code> - integers<br>
- <code><a href="../reference/chr.html">chr()</a></code> - character strings - <code><a href="../reference/lgl.html">lgl()</a></code> - logical
(TRUE/FALSE) - <code><a href="../reference/lst.html">lst()</a></code> - lists (can specify nested
prototypes) - <code><a href="../reference/file_ref.html">file_ref()</a></code> - file artifacts with metadata</p>
</div>
<div class="section level2">
<h2 id="execute-local-or-distributed">3) Execute: local or distributed<a class="anchor" aria-label="anchor" href="#execute-local-or-distributed"></a>
</h2>
<p>Once your flow is defined, execution is straightforward:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up progress reporting</span></span>
<span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Execute the flow</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collect.html">collect</a></span><span class="op">(</span><span class="va">fl2</span>, engine <span class="op">=</span> <span class="st">"future"</span>, workers <span class="op">=</span> <span class="fl">4</span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<p><strong>Execution options:</strong> -
<strong><code>engine = "sequential"</code></strong>: Single-threaded,
good for debugging - <strong><code>engine = "future"</code></strong>:
Parallel execution using the future framework -
<strong><code>workers</code></strong>: Number of parallel processes -
<strong><code>.progress</code></strong>: Show progress bars during
execution</p>
<p>Each row in the output represents one parameter combination with: -
<strong>Original parameters</strong> from the grid - <strong>Stage
outputs</strong> (typed and validated) -
<strong><code>.ok</code></strong>: Overall success status for each row -
<strong><code>.diag</code></strong>: Detailed diagnostic information per
stage</p>
</div>
<div class="section level2">
<h2 id="common-workflows">Common workflows<a class="anchor" aria-label="anchor" href="#common-workflows"></a>
</h2>
<div class="section level3">
<h3 id="error-handling">Error handling<a class="anchor" aria-label="anchor" href="#error-handling"></a>
</h3>
<p>Control what happens when stages fail:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Different error policies</span></span>
<span><span class="va">fl_robust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flow.html">flow</a></span><span class="op">(</span><span class="va">grid</span>, error <span class="op">=</span> <span class="st">"keep"</span><span class="op">)</span>     <span class="co"># Keep failed rows in output</span></span>
<span><span class="va">fl_strict</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flow.html">flow</a></span><span class="op">(</span><span class="va">grid</span>, error <span class="op">=</span> <span class="st">"stop"</span><span class="op">)</span>     <span class="co"># Stop on first error  </span></span>
<span><span class="va">fl_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flow.html">flow</a></span><span class="op">(</span><span class="va">grid</span>, error <span class="op">=</span> <span class="st">"omit"</span><span class="op">)</span>     <span class="co"># Remove failed rows</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="conditional-execution">Conditional execution<a class="anchor" aria-label="anchor" href="#conditional-execution"></a>
</h3>
<p>Skip stages based on conditions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl_conditional</span> <span class="op">&lt;-</span> <span class="va">fl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stage.html">stage</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"optional_step"</span>,</span>
<span>    needs <span class="op">=</span> <span class="st">"prep"</span>,</span>
<span>    f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">prep.df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>processed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    schema <span class="op">=</span> <span class="fu"><a href="../reference/schema.html">schema</a></span><span class="op">(</span>processed <span class="op">=</span> <span class="fu"><a href="../reference/lgl.html">lgl</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    skip_when <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">prep.df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">prep.df</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span>  <span class="co"># Skip if no data</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="debugging-workflows">Debugging workflows<a class="anchor" aria-label="anchor" href="#debugging-workflows"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run a small subset first</span></span>
<span><span class="va">test_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collect.html">collect</a></span><span class="op">(</span><span class="va">fl2</span>, limit <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check for failures</span></span>
<span><span class="va">failed_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/failed.html">failed</a></span><span class="op">(</span><span class="va">test_results</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Examine diagnostics</span></span>
<span><span class="va">stage_diagnostics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diagnostics.html">diagnostics</a></span><span class="op">(</span><span class="va">test_results</span>, stage <span class="op">=</span> <span class="st">"fit"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<strong>parade-paths</strong>: Learn about artifact management and
path aliases</li>
<li>
<strong>parade-slurm-distribution</strong>: Scale to HPC clusters
with SLURM</li>
<li>
<strong>parade-sinks</strong>: Persist intermediate results and
manage artifacts</li>
<li>
<strong>parade-defaults</strong>: Configure site-wide and
project-specific settings</li>
</ul>
<p>The power of parade lies in its composability - start simple with
local execution, then scale to distributed computing as your needs grow,
all with the same declarative interface.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Parade Authors.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
